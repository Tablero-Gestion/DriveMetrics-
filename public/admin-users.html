<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Usuarios Registrados - DriveMetrics</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: linear-gradient(135deg, #667eea, #764ba2); margin: 0; padding: 20px; color: #1f2a44; min-height: 100vh; }
        .container { max-width: 1400px; margin: 0 auto; background: rgba(255, 255, 255, 0.95); border-radius: 20px; padding: 30px; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1); }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; padding-bottom: 20px; border-bottom: 2px solid #f1f5f9; }
        .header h1 { color: #1e293b; font-size: 28px; font-weight: 700; }
        .stats { display: flex; gap: 20px; }
        .stat-card { background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 15px 20px; border-radius: 12px; text-align: center; min-width: 120px; }
        .stat-card .number { font-size: 24px; font-weight: 700; display: block; }
        .stat-card .label { font-size: 12px; opacity: 0.9; text-transform: uppercase; letter-spacing: 0.5px; }
        .filters { display: flex; gap: 15px; margin-bottom: 25px; align-items: center; flex-wrap: wrap; }
        .filter-group { display: flex; flex-direction: column; gap: 5px; }
        .filter-group label { font-size: 12px; font-weight: 600; color: #64748b; text-transform: uppercase; }
        .filter-input { padding: 10px 15px; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 14px; background: white; transition: border-color 0.3s ease; }
        .filter-input:focus { outline: none; border-color: #667eea; }
        .btn { padding: 10px 20px; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; font-size: 14px; }
        .btn-primary { background: linear-gradient(135deg, #667eea, #764ba2); color: white; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3); }
        .btn-secondary { background: #f8fafc; color: #475569; border: 1px solid #e2e8f0; }
        .btn-secondary:hover { background: #f1f5f9; }
        .table-container { background: white; border-radius: 15px; overflow: hidden; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08); }
        table { width: 100%; border-collapse: collapse; }
        thead { background: linear-gradient(135deg, #667eea, #764ba2); color: white; }
        th { padding: 18px 15px; text-align: left; font-weight: 600; font-size: 14px; text-transform: uppercase; letter-spacing: 0.5px; cursor: pointer; user-select: none; position: relative; }
        th:hover { background: rgba(255, 255, 255, 0.1); }
        th.sortable::after { content: "‚ÜïÔ∏è"; position: absolute; right: 8px; font-size: 12px; opacity: 0.7; }
        th.sort-asc::after { content: "‚Üë"; opacity: 1; }
        th.sort-desc::after { content: "‚Üì"; opacity: 1; }
        tbody tr { transition: all 0.3s ease; }
        tbody tr:nth-child(even) { background: #f8fafc; }
        tbody tr:hover { background: #e2e8f0; transform: scale(1.01); }
        td { padding: 15px; font-size: 14px; border-bottom: 1px solid #f1f5f9; }
        .status { padding: 6px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; }
        .status-active { background: #dcfce7; color: #166534; }
        .status-pending { background: #fef3c7; color: #92400e; }
        .status-inactive { background: #fecaca; color: #991b1b; }
        .plan { padding: 6px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; }
        .plan-trial { background: #fef3c7; color: #92400e; }
        .plan-premium { background: #dcfce7; color: #166534; }
        .plan-basic { background: #e0f2fe; color: #0277bd; }
        .location-badge { background: #dbeafe; color: #1e40af; padding: 4px 8px; border-radius: 6px; font-size: 11px; font-weight: 500; }
        .actions { display: flex; gap: 8px; }
        .action-btn { padding: 6px 10px; border: none; border-radius: 6px; cursor: pointer; font-size: 12px; font-weight: 500; transition: all 0.3s ease; }
        .action-view { background: #e0f2fe; color: #0277bd; }
        .action-edit { background: #f3e8ff; color: #7c3aed; }
        .action-delete { background: #fce4ec; color: #c2185b; }
        .action-btn:hover { transform: scale(1.1); }
        .pagination { display: flex; justify-content: center; align-items: center; margin-top: 25px; gap: 10px; }
        .page-btn { padding: 8px 12px; border: 1px solid #e2e8f0; background: white; border-radius: 6px; cursor: pointer; font-size: 14px; transition: all 0.3s ease; }
        .page-btn:hover { background: #f8fafc; }
        .page-btn.active { background: linear-gradient(135deg, #667eea, #764ba2); color: white; border-color: transparent; }
        .no-results { text-align: center; padding: 40px; color: #64748b; font-size: 16px; }
        .export-section { display: flex; gap: 10px; align-items: center; }
        @media (max-width: 768px) { .container { margin: 10px; padding: 20px; } .header { flex-direction: column; gap: 20px; } .filters { flex-direction: column; align-items: stretch; } .filter-group { width: 100%; } table { font-size: 12px; } th, td { padding: 10px 8px; } .actions { flex-direction: column; } }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üë• Usuarios Registrados</h1>
            <div class="stats">
                <div class="stat-card">
                    <span class="number" id="totalUsers">0</span>
                    <span class="label">Total</span>
                </div>
                <div class="stat-card">
                    <span class="number" id="activeUsers">0</span>
                    <span class="label">Activos</span>
                </div>
                <div class="stat-card">
                    <span class="number" id="todayUsers">0</span>
                    <span class="label">Hoy</span>
                </div>
                <div class="stat-card">
                    <span class="number" id="paidUsers">0</span>
                    <span class="label">Pagado</span>
                </div>
            </div>
        </div>

        <div class="filters">
            <div class="filter-group">
                <label>Buscar</label>
                <input type="text" class="filter-input" id="searchInput" placeholder="Nombre, email o ciudad...">
            </div>
            <div class="filter-group">
                <label>Estado</label>
                <select class="filter-input" id="statusFilter">
                    <option value="">Todos</option>
                    <option value="active">Activo</option>
                    <option value="pending">Pendiente</option>
                    <option value="inactive">Inactivo</option>
                </select>
            </div>
            <div class="filter-group">
                <label>Ciudad</label>
                <select class="filter-input" id="cityFilter">
                    <option value="">Todas</option>
                    <option value="Buenos Aires">Buenos Aires</option>
                    <option value="C√≥rdoba">C√≥rdoba</option>
                    <option value="Rosario">Rosario</option>
                    <option value="Mendoza">Mendoza</option>
                </select>
            </div>
            <div class="filter-group">
                <label>Plan</label>
                <select class="filter-input" id="planFilter">
                    <option value="">Todos</option>
                    <option value="trial">Prueba</option>
                    <option value="basic">B√°sico</option>
                    <option value="premium">Premium</option>
                </select>
            </div>
            <div class="filter-group">
                <label>Fecha</label>
                <input type="date" class="filter-input" id="dateFilter">
            </div>
            <div class="export-section">
                <button class="btn btn-secondary" onclick="exportToCSV()">üìä Exportar CSV</button>
                <button class="btn btn-primary" onclick="addNewUser()">‚ûï Nuevo Usuario</button>
            </div>
        </div>

        <div class="table-container">
            <table id="usersTable">
                <thead>
                    <tr>
                        <th class="sortable" data-sort="id">ID</th>
                        <th class="sortable" data-sort="name">Nombre</th>
                        <th class="sortable" data-sort="email">Email</th>
                        <th class="sortable" data-sort="phone">Tel√©fono</th>
                        <th class="sortable" data-sort="city">Ciudad</th>
                        <th class="sortable" data-sort="plan">Plan</th>
                        <th class="sortable" data-sort="registrationDate">Fecha Registro</th>
                        <th class="sortable" data-sort="status">Estado</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody id="usersTableBody">
                </tbody>
            </table>
        </div>

        <div class="pagination" id="pagination">
        </div>
    </div>
    <script>
        // Variables globales
        let users = [];
        let filteredUsers = [];
        let currentPage = 1;
        const usersPerPage = 5;

        // Inicializaci√≥n - cargar usuarios reales
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('üöÄ Cargando panel de usuarios...');
            await loadRealUsers();
        });

        // Funci√≥n para cargar usuarios reales desde el backend
        async function loadRealUsers() {
            try {
                console.log('üì° Conectando con el backend local...');
                
                // Intentar conectar con el backend local primero
                const response = await fetch('http://localhost:3000/api/admin/usuarios');
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                
                if (data.success && data.usuarios) {
                    users = data.usuarios;
                    filteredUsers = [...users];
                    console.log(`‚úÖ Cargados ${users.length} usuarios reales`);
                    updateStats();
                    renderTable();
                } else {
                    throw new Error('Formato de respuesta inv√°lido');
                }
                
            } catch (error) {
                console.warn('‚ö†Ô∏è No se pudo conectar con el backend local:', error.message);
                console.log('üìù Usando datos de demostraci√≥n...');
                
                // Sin usuarios - mostrar mensaje de configuraci√≥n
                users = [];
                filteredUsers = [];
                updateStats();
                
                // Mostrar mensaje de configuraci√≥n
                showConfigMessage(data.message || error.message);
            }
        }

        function showConfigMessage(message) {
            const tbody = document.getElementById('usersTableBody');
            tbody.innerHTML = `
                <tr>
                    <td colspan="9" style="text-align: center; padding: 40px; background: #e3f2fd; color: #1565c0; border-radius: 8px;">
                        <h3>üîó Configuraci√≥n de Vercel PostgreSQL</h3>
                        <p><strong>Para ver usuarios REALES:</strong></p>
                        <div style="text-align: left; display: inline-block; margin-top: 15px; background: #f5f5f5; padding: 15px; border-radius: 8px;">
                            <h4>üìã Pasos para configurar:</h4>
                            <ol>
                                <li>Ve a <a href="https://vercel.com/dashboard" target="_blank">vercel.com/dashboard</a></li>
                                <li>Selecciona tu proyecto <code>drive-metrics-psi</code></li>
                                <li>Ve a <strong>Storage</strong> ‚Üí <strong>PostgreSQL</strong></li>
                                <li>Copia las variables de entorno <code>POSTGRES_URL</code></li>
                                <li>Agr√©galas a tu archivo <code>env.local</code></li>
                                <li>Reinicia el servidor: <code>npm start</code></li>
                            </ol>
                        </div>
                        <div style="margin-top: 15px; font-size: 12px; color: #666;">
                            <strong>Estado actual:</strong> ${message || 'Sin conexi√≥n a Vercel PostgreSQL'}
                        </div>
                        <button onclick="loadRealUsers()" style="margin-top: 15px; padding: 8px 16px; background: #2196f3; color: white; border: none; border-radius: 4px; cursor: pointer;">üîÑ Reintentar Conexi√≥n</button>
                        <button onclick="window.open('https://vercel.com/dashboard', '_blank')" style="margin-top: 15px; margin-left: 10px; padding: 8px 16px; background: #4caf50; color: white; border: none; border-radius: 4px; cursor: pointer;">üåê Ir a Vercel Dashboard</button>
                    </td>
                </tr>
            `;
        }

        function updateStats() {
            document.getElementById('totalUsers').textContent = users.length;
            document.getElementById('activeUsers').textContent = users.filter(u => u.status === 'active').length;
            document.getElementById('paidUsers').textContent = users.filter(u => u.plan === 'basic' || u.plan === 'premium').length;
        }

        function renderTable() {
            const tbody = document.getElementById('usersTableBody');
            tbody.innerHTML = users.map(user => `
                <tr>
                    <td>#${user.id.toString().padStart(3, '0')}</td>
                    <td><strong>${user.name}</strong></td>
                    <td>${user.email}</td>
                    <td>${user.phone}</td>
                    <td>
                        <span class="location-badge">${user.city}</span>
                        ${user.source ? `<br><small style="color: #6b7280; font-size: 10px;">${user.source}</small>` : ''}
                    </td>
                    <td><span class="plan plan-${user.plan}">${user.plan}</span></td>
                    <td>${user.registrationDate}</td>
                    <td><span class="status status-${user.status}">${user.status}</span></td>
                    <td class="actions">
                        <button class="action-btn action-view" title="Ver">üëÅÔ∏è</button>
                        <button class="action-btn action-edit" title="Editar">‚úèÔ∏è</button>
                        <button class="action-btn action-delete" title="Eliminar">üóëÔ∏è</button>
                    </td>
                </tr>
            `).join('');
        }
    </script>
</body>
</html>
