<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DriveMetrics - Dashboard</title>
    <script src="https://apis.google.com/js/api.js"></script>
    <script src="https://accounts.google.com/gsi/client"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; }
        .loading-screen { position: fixed; inset: 0; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 9999; transition: opacity .5s ease; }
        .loading-screen.hidden { opacity: 0; pointer-events: none; }
        .loading-logo { font-size: 4rem; margin-bottom: 1rem; animation: bounce 1s infinite; }
        @keyframes bounce { 0%,100%{transform:translateY(0)} 50%{transform:translateY(-10px)} }
        .loading-text { color: #fff; font-size: 1.2rem; margin-bottom: 2rem; }
        .spinner { border: 4px solid rgba(255,255,255,.3); border-top: 4px solid #fff; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; }
        @keyframes spin { 0%{transform:rotate(0)} 100%{transform:rotate(360deg)} }
        .login-container { position: fixed; inset: 0; display:flex; align-items:center; justify-content:center; z-index:1000; transition: all .5s ease; }
        .login-box { background:#fff; padding:2.5rem; border-radius:20px; box-shadow:0 20px 40px rgba(0,0,0,.2); text-align:center; max-width:420px; width:90%; transform:scale(.9); animation: scaleIn .5s ease forwards; }
        @keyframes scaleIn { to { transform: scale(1);} }
        .logo { font-size:2.5rem; color:#667eea; margin-bottom:1rem; }
        .title { font-size:1.8rem; color:#333; margin-bottom:.5rem; font-weight:600; }
        .subtitle { color:#666; margin-bottom:2rem; font-size:.95rem; }
        .google-btn { display:inline-flex; align-items:center; justify-content:center; gap:12px; background:#4285f4; color:#fff; border:none; padding:16px 24px; border-radius:50px; font-size:1.1rem; font-weight:500; cursor:pointer; transition: all .3s ease; width:100%; margin-bottom:1rem; }
        .google-btn:hover { background:#3367d6; transform: translateY(-2px); box-shadow:0 8px 25px rgba(66,133,244,.4); }
        .google-btn:disabled { opacity:.6; cursor:not-allowed; transform:none; }
        .google-icon { width:22px; height:22px; background:#fff; border-radius:4px; padding:3px; flex-shrink:0; }
        .message { padding:12px; border-radius:8px; margin-top:1rem; font-size:.9rem; display:none; }
        .error-message { background:#fee; border:1px solid #fcc; color:#c33; }
        .success-message { background:#efe; border:1px solid #cfc; color:#3c3; }
        .dashboard { opacity:0; pointer-events:none; transition:opacity .5s ease; min-height:100vh; padding:20px; }
        .dashboard.active { opacity:1; pointer-events:all; }
        .dashboard-header { background:#fff; padding:1rem 2rem; border-radius:12px; box-shadow:0 2px 10px rgba(0,0,0,.1); margin-bottom:2rem; display:flex; justify-content:space-between; align-items:center; }
        .user-info { display:flex; align-items:center; gap:15px; }
        .user-avatar { width:50px; height:50px; border-radius:50%; border:3px solid #667eea; }
        .user-details h3 { margin:0; color:#333; font-size:1.1rem; }
        .user-details p { margin:0; color:#666; font-size:.9rem; }
        .logout-btn { background:#dc3545; color:#fff; border:none; padding:10px 20px; border-radius:25px; cursor:pointer; font-size:.9rem; transition: all .3s ease; }
        .logout-btn:hover { background:#c82333; transform: translateY(-1px); }
        .dashboard-content { background:#fff; padding:2rem; border-radius:12px; box-shadow:0 4px 15px rgba(0,0,0,.1); }
        .welcome-section { text-align:center; margin-bottom:3rem; }
        .welcome-section h1 { color:#667eea; font-size:2.5rem; margin-bottom:1rem; }
        .welcome-section p { color:#666; font-size:1.1rem; }
        .calculator-section { background:#f8f9fa; padding:2rem; border-radius:12px; margin-top:2rem; border-left:4px solid #667eea; }
        .calculator-section h2 { color:#667eea; margin-bottom:1rem; }
        .hidden { display:none !important; }
        .fade-in { animation: fadeIn .5s ease forwards; }
        @keyframes fadeIn { from{opacity:0; transform:translateY(20px)} to{opacity:1; transform:translateY(0)} }
        @media (max-width:768px){ .dashboard-header{flex-direction:column; gap:1rem} .user-info{justify-content:center} }

        /* === Estilos de la calculadora (seg√∫n tu dise√±o) === */
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header { text-align: center; margin-bottom: 40px; color: white; }
        .header h1 { font-size: 2.5rem; margin-bottom: 10px; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); }
        .header p { font-size: 1.2rem; opacity: 0.9; }
        .calculator-container { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 40px; }
        .input-section { background: white; padding: 30px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        .results-section { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 30px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); color: white; }
        .section-title { font-size: 1.5rem; margin-bottom: 20px; font-weight: 700; }
        .input-group { margin-bottom: 20px; }
        .input-group label { display: block; margin-bottom: 5px; font-weight: 600; color: #333; }
        .input-group input, .input-group select { width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 1rem; transition: border-color 0.3s ease; }
        .input-group input:focus, .input-group select:focus { outline: none; border-color: #667eea; }
        .platform-selector { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 20px; }
        .platform-btn { padding: 15px; border: 2px solid #e0e0e0; background: white; border-radius: 8px; cursor: pointer; text-align: center; transition: all 0.3s ease; font-weight: 600; }
        .platform-btn.active { background: #667eea; color: white; border-color: #667eea; }
        .calculate-btn { width: 100%; padding: 15px; background: linear-gradient(45deg, #667eea, #764ba2); color: white; border: none; border-radius: 8px; font-size: 1.1rem; font-weight: 600; cursor: pointer; transition: transform 0.3s ease; }
        .calculate-btn:hover { transform: translateY(-2px); }
        .result-card { background: rgba(255,255,255,0.1); padding: 20px; border-radius: 10px; margin-bottom: 15px; backdrop-filter: blur(10px); }
        .result-title { font-size: 0.9rem; opacity: 0.8; margin-bottom: 5px; }
        .result-value { font-size: 2rem; font-weight: 700; }
        .recommendations { background: white; padding: 30px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); margin-bottom: 30px; }
        .export-btn { background: #28a745; color: white; padding: 12px 30px; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; margin: 10px 5px; }
        @media (max-width: 768px) { .calculator-container { grid-template-columns: 1fr; } .platform-selector { grid-template-columns: 1fr; } .header h1 { font-size: 2rem; } }

        /* Predictor IA (seg√∫n dise√±o solicitado) */
        .predictor-ia-section { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 40px 30px; border-radius: 15px; margin: 30px 0; color: white; }
        .predictor-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-top: 20px; }
        .prediccion-card { background: rgba(255,255,255,0.1); padding: 25px; border-radius: 12px; backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.2); transition: transform 0.3s ease; }
        .prediccion-card:hover { transform: translateY(-5px); }
        .prediccion-card.full-width { grid-column: 1 / -1; }
        .ia-icon { font-size: 2rem; margin-bottom: 10px; text-align: center; }
        .prediccion-card h3 { margin-bottom: 15px; font-size: 1.2rem; text-align: center; }
        .prediccion-content { background: rgba(255,255,255,0.05); padding: 15px; border-radius: 8px; border-left: 4px solid #ffd700; font-size: 0.95rem; line-height: 1.5; }
        .prediccion-highlight { color: #ffd700; font-weight: bold; font-size: 1.1rem; }
        .prediccion-numero { color: #00ff88; font-weight: bold; font-size: 1.2rem; }

        /* Mapa de calor - Zonas Premium */
        .mapa-calor-section { background: #fff; padding: 30px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); margin: 30px 0; }
        .ubicacion-detector { text-align: center; margin-bottom: 30px; padding: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 10px; }
        .detectar-btn { background: #fff; color: #667eea; padding: 15px 30px; border: none; border-radius: 25px; font-weight: 600; cursor: pointer; font-size: 1rem; transition: all .3s ease; }
        .detectar-btn:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        .ubicacion-info { margin-top: 15px; color: #fff; font-size: 1.1rem; }
        .mapa-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; }
        .zona-actual-card, .zonas-premium-card, .comparacion-zonas, .horarios-zona { background: #f8f9ff; padding: 20px; border-radius: 10px; border-left: 4px solid #667eea; }
        .zona-actual-card h3, .zonas-premium-card h3, .comparacion-zonas h3, .horarios-zona h3 { color: #667eea; margin-bottom: 15px; font-size: 1.1rem; }
        .zona-premium-item { display:flex; justify-content:space-between; align-items:center; padding:10px; background:#fff; border-radius:5px; margin-bottom:8px; border-left:3px solid #00ff88; }
        .zona-nombre-premium { font-weight:600; }
        .zona-ganancia { color:#00ff88; font-weight:bold; }
        .zona-comparacion { display:grid; grid-template-columns:2fr 1fr 1fr; gap:10px; padding:12px; background:#fff; border-radius:5px; margin-bottom:8px; align-items:center; }
        .zona-potencial { color:#667eea; font-weight:bold; }
        .zona-diferencia { background:#00ff88; color:#fff; padding:5px 10px; border-radius:15px; text-align:center; font-size:.9rem; font-weight:bold; }
        .zona-diferencia.negativa { background:#ff4757; }
        .horario-zona-item { background:#fff; padding:12px; border-radius:5px; margin-bottom:10px; border-left:3px solid #ffd700; }
        .horario-zona-titulo { font-weight:600; color:#333; margin-bottom:5px; }
        .horario-zona-detalle { font-size:.9rem; color:#666; }
        .alerta-zona { background: linear-gradient(45deg, #ff6b6b, #ee5a6f); color:#fff; padding:15px; border-radius:8px; margin-top:15px; text-align:center; }
    </style>
</head>
<body>
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-logo">üöó</div>
        <div class="loading-text">Cargando DriveMetrics...</div>
        <div class="spinner"></div>
    </div>

    <div class="login-container hidden" id="loginContainer">
        <div class="login-box">
            <div class="logo">üöó</div>
            <h1 class="title">DriveMetrics</h1>
            <p class="subtitle">Inicia sesi√≥n para acceder a tu dashboard de m√©tricas de conducci√≥n</p>
            <button class="google-btn" id="googleLoginBtn" onclick="iniciarGoogleAuth()">
                <svg class="google-icon" viewBox="0 0 24 24">
                    <path fill="#4285f4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                    <path fill="#34a853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                    <path fill="#fbbc05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                    <path fill="#ea4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                </svg>
                Continuar con Google
            </button>
            <div class="message error-message" id="errorMessage"></div>
            <div class="message success-message" id="successMessage"></div>
        </div>
    </div>

    <div class="dashboard" id="dashboard">
        <div class="dashboard-header">
            <div class="user-info">
                <img class="user-avatar" id="userAvatar" src="" alt="Avatar">
                <div class="user-details">
                    <h3 id="userName">Cargando...</h3>
                    <p id="userEmail">Cargando...</p>
                </div>
            </div>
            <button class="logout-btn" onclick="cerrarSesion()">Cerrar Sesi√≥n</button>
        </div>
        <div class="dashboard-content">
            <div class="welcome-section">
                <h1>¬°Bienvenido a DriveMetrics!</h1>
                <p>Tu dashboard personalizado est√° listo. Sesi√≥n iniciada correctamente.</p>
            </div>

            <!-- Calculadora principal (estructura base) -->
            <div class="container" id="calcRoot">
        <div class="header">
            <h1>üöóüí∞ Calculadora de Ganancias</h1>
            <p>Uber ‚Ä¢ Rappi ‚Ä¢ Pedidos Ya ‚Ä¢ Argentina</p>
        </div>

        <div class="calculator-container">
            <!-- SECCI√ìN DE INPUTS -->
            <div class="input-section">
                <h2 class="section-title">üìä Datos de Trabajo</h2>
                
                <div class="platform-selector" id="platformSelector">
                    <button class="platform-btn active" data-platform="uber">üöó Uber</button>
                    <button class="platform-btn" data-platform="didi">üöñ DiDi</button>
                    <button class="platform-btn" data-platform="rappi">üõµ Rappi</button>
                    <button class="platform-btn" data-platform="pedidosya">üçï PedidosYa</button>
                </div>

                <div class="input-group">
                    <label>üíµ Ganancia Bruta (por d√≠a)</label>
                    <input type="number" id="ganancia-bruta" placeholder="8000" value="8000">
                </div>

                <div class="input-group">
                    <label>‚è∞ Horas trabajadas (por d√≠a)</label>
                    <input type="number" id="horas-dia" placeholder="8" value="8">
                </div>

                <div class="input-group">
                    <label>üè¢ D√≠as trabajados (por semana)</label>
                    <input type="number" id="dias-semana" placeholder="6" value="6">
                </div>

                <div class="input-group">
                    <label>‚õΩ Km recorridos (por d√≠a)</label>
                    <input type="number" id="km-dia" placeholder="150" value="150">
                </div>

                <div class="input-group">
                    <label>üöó Consumo del auto (km/litro)</label>
                    <input type="number" id="consumo-auto" placeholder="12" value="12">
                </div>

                <div class="input-group">
                    <label>‚õΩ Precio nafta (por litro)</label>
                    <input type="number" id="precio-nafta" placeholder="850" value="850">
                </div>

                <div class="input-group">
                    <label>üîß Gastos adicionales (por d√≠a)</label>
                    <input type="number" id="gastos-adicionales" placeholder="500" value="500">
                </div>

                <button class="calculate-btn" onclick="calcular()">
                    üßÆ CALCULAR GANANCIAS REALES
                </button>
            </div>

            <!-- SECCI√ìN DE RESULTADOS -->
            <div class="results-section">
                <h2 class="section-title">üí∞ Tus Ganancias Reales</h2>
                
                <div class="result-card">
                    <div class="result-title">Ganancia por hora</div>
                    <div class="result-value" id="ganancia-hora">$0</div>
                </div>

                <div class="result-card">
                    <div class="result-title">Ganancia diaria NETA</div>
                    <div class="result-value" id="ganancia-dia">$0</div>
                </div>

                <div class="result-card">
                    <div class="result-title">Ganancia semanal</div>
                    <div class="result-value" id="ganancia-semana">$0</div>
                </div>

                <div class="result-card">
                    <div class="result-title">Ganancia mensual</div>
                    <div class="result-value" id="ganancia-mes">$0</div>
                </div>

                <div class="result-card">
                    <div class="result-title">Gastos totales por d√≠a</div>
                    <div class="result-value" id="gastos-totales">$0</div>
                </div>
            </div>
        </div>

        <!-- RECOMENDACIONES -->
        <div class="recommendations">
            <h2 class="section-title">üí° Recomendaciones Personalizadas</h2>
            <div id="recomendaciones-content">
                <p>Completa los datos arriba para ver tus recomendaciones personalizadas</p>
            </div>
            
            <div style="margin-top: 20px;">
                <button class="export-btn" onclick="exportarPDF()">üìÑ Exportar PDF</button>
                <button class="export-btn" onclick="compartir()">üì± Compartir Resultados</button>
            </div>
        </div>

        <!-- SECCI√ìN PREDICTOR IA -->
        <div class="predictor-ia-section">
            <h2 class="section-title">ü§ñ Predictor IA Premium</h2>
            <div class="predictor-container">
                <div class="prediccion-card">
                    <div class="ia-icon">üöÄ</div>
                    <h3>Optimizaci√≥n Autom√°tica</h3>
                    <div id="prediccion-optimizacion" class="prediccion-content">Analizando tus datos...</div>
                </div>
                <div class="prediccion-card">
                    <div class="ia-icon">üìä</div>
                    <h3>Comparaci√≥n Inteligente</h3>
                    <div id="prediccion-comparacion" class="prediccion-content">Calculando mejores opciones...</div>
                </div>
                <div class="prediccion-card">
                    <div class="ia-icon">üí∞</div>
                    <h3>Potencial de Crecimiento</h3>
                    <div id="prediccion-crecimiento" class="prediccion-content">Evaluando oportunidades...</div>
                </div>
                <div class="prediccion-card full-width">
                    <div class="ia-icon">üéØ</div>
                    <h3>Plan de Acci√≥n Personalizado</h3>
                    <div id="plan-accion" class="prediccion-content">Generando estrategia √≥ptima...</div>
                </div>
            </div>
        </div>

        <!-- MAPA DE CALOR DE GANANCIAS -->
        <div class="mapa-calor-section">
            <h2 class="section-title">üìç Mapa de Calor - Zonas Premium</h2>
            <div class="ubicacion-detector">
                <button id="detectar-ubicacion" class="detectar-btn">üìç Detectar Mi Ubicaci√≥n</button>
                <div id="ubicacion-actual" class="ubicacion-info hidden">
                    <strong>Tu ubicaci√≥n:</strong> <span id="ciudad-detectada"></span>
                </div>
            </div>
            <div class="mapa-container">
                <div class="zona-actual-card">
                    <h3>üìå Tu Zona Actual</h3>
                    <div id="analisis-zona-actual"><p>Detecta tu ubicaci√≥n para an√°lisis personalizado</p></div>
                </div>
                <div class="zonas-premium-card">
                    <h3>üî• Zonas Premium de Tu Ciudad</h3>
                    <div id="zonas-premium-list"><p>Cargando zonas...</p></div>
                </div>
                <div class="comparacion-zonas">
                    <h3>‚ö° Comparaci√≥n de Ganancias</h3>
                    <div id="comparacion-ganancias-zonas"></div>
                </div>
                <div class="horarios-zona">
                    <h3>‚è∞ Mejores Horarios por Zona</h3>
                    <div id="horarios-optimizados"></div>
                </div>
            </div>
        </div>

        <!-- FOOTER DE VENTA -->
        <div style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 10px; text-align: center; color: white;">
            <h3>üöÄ ¬øTe sirvi√≥ esta calculadora?</h3>
            <p>Ayuda a otros drivers compartiendo esta herramienta</p>
            <p style="margin-top: 10px; font-size: 0.9rem; opacity: 0.8;">
                Desarrollado por un argentino para argentinos üá¶üá∑
            </p>
        </div>
    </div>
        </div>
    </div>

    <script>
        const GOOGLE_CLIENT_ID = '151117015962-qhq4at3nbja8q9rq7qvspcc0sunr113u.apps.googleusercontent.com';
        const firebaseConfig = {
            apiKey: 'AIzaSyCFDb40oDXxQRG4PY0GAIaC8Ck7zS9tm0A',
            authDomain: 'drivemetrics-9ef78.firebaseapp.com',
            projectId: 'drivemetrics-9ef78',
            storageBucket: 'drivemetrics-9ef78.firebasestorage.app',
            messagingSenderId: '151117015962',
            appId: '1:151117015962:web:576aff049892be2760e823'
        };
        let currentUser = null;

        document.addEventListener('DOMContentLoaded', async function() {
            mostrarPantalla('loading');
            try {
                await new Promise(r => setTimeout(r, 600));
                if (window.firebase && !firebase.apps.length) {
                    firebase.initializeApp(firebaseConfig);
                }
                const sesion = await verificarSesionExistente();
                if (sesion) {
                    await mostrarDashboard(sesion);
                } else {
                    const redirectHecho = await procesarRedirectResult();
                    if (!redirectHecho) mostrarPantalla('login');
                }
            } catch(e) {
                console.error(e); mostrarPantalla('login');
            }
        });

        async function iniciarGoogleAuth(){
            const btn = document.getElementById('googleLoginBtn');
            try{
                btn.disabled = true; btn.textContent = 'Iniciando...';
                if (window.firebase && firebase.auth){
                    const auth = firebase.auth();
                    const provider = new firebase.auth.GoogleAuthProvider();
                    provider.addScope('email'); provider.addScope('profile'); provider.setCustomParameters({ prompt: 'select_account' });
                    try{
                        const result = await auth.signInWithPopup(provider);
                        await manejarAutenticacionExitosa(result.user);
                    }catch(err){
                        if (err.code === 'auth/popup-blocked') { await auth.signInWithRedirect(provider); }
                        else { throw err; }
                    }
                } else { throw new Error('Firebase no est√° disponible'); }
            }catch(err){ manejarErrorLogin(err); }
            finally{ btn.disabled = false; btn.textContent = 'Continuar con Google'; }
        }

        async function procesarRedirectResult(){
            if (!(window.firebase && firebase.auth)) return false;
            try{
                const result = await firebase.auth().getRedirectResult();
                if (result && result.user){ await manejarAutenticacionExitosa(result.user); return true; }
            }catch(err){ manejarErrorLogin(err); }
            return false;
        }

        async function verificarSesionExistente(){
            const saved = localStorage.getItem('drivemetrics_user');
            if (saved){ try { return JSON.parse(saved); } catch{ localStorage.removeItem('drivemetrics_user'); } }
            if (window.firebase && firebase.auth){
                return new Promise((resolve)=>{
                    const unsub = firebase.auth().onAuthStateChanged((user)=>{
                        unsub(); resolve(user ? { id:user.uid, email:user.email, name:user.displayName, picture:user.photoURL, provider:'google' } : null);
                    });
                });
            }
            return null;
        }

        async function manejarAutenticacionExitosa(user){
            const userData = { id:user.uid, email:user.email, name:user.displayName, picture:user.photoURL, provider:'google', loginTime:new Date().toISOString() };
            localStorage.setItem('drivemetrics_user', JSON.stringify(userData));
            currentUser = userData; await mostrarDashboard(userData);
        }

        async function mostrarDashboard(userData){
            document.getElementById('userAvatar').src = userData.picture || 'https://via.placeholder.com/50';
            document.getElementById('userName').textContent = userData.name || 'Usuario';
            document.getElementById('userEmail').textContent = userData.email || '';
            document.getElementById('dashboardUserName') && (document.getElementById('dashboardUserName').textContent = userData.name || 'Usuario');
            mostrarPantalla('dashboard');

            // Enlazar eventos b√°sicos de la calculadora
            const btn = document.getElementById('btnCalcular');
            if (btn && !btn._bound) {
                btn.addEventListener('click', () => {
                    // Placeholder: c√°lculo m√≠nimo de demostraci√≥n
                    const netoDia = 0;
                    const netoHora = 0;
                    document.getElementById('resNetoDia').textContent = `$ ${netoDia.toFixed(2)}`;
                    document.getElementById('resNetoHora').textContent = `$ ${netoHora.toFixed(2)}`;
                });
                btn._bound = true;
            }
        }

        async function cerrarSesion(){
            try{ if (window.firebase && firebase.auth) await firebase.auth().signOut(); }catch{}
            localStorage.removeItem('drivemetrics_user'); currentUser=null; mostrarPantalla('login');
        }

        function mostrarPantalla(tipo){
            const loading = document.getElementById('loadingScreen');
            const login = document.getElementById('loginContainer');
            const dash = document.getElementById('dashboard');
            loading.classList.add('hidden'); login.classList.add('hidden'); dash.classList.remove('active');
            if (tipo==='loading') loading.classList.remove('hidden');
            if (tipo==='login') login.classList.remove('hidden');
            if (tipo==='dashboard') dash.classList.add('active');
        }

        function manejarErrorLogin(error){
            console.error('Login error', error);
            let m='Error al iniciar sesi√≥n';
            if(error.code==='auth/unauthorized-domain') m='Dominio no autorizado en Firebase';
            if(error.code==='auth/popup-blocked') m='Popup bloqueado: permita popups o use redirect';
            mostrarError(m);
        }
        function mostrarError(m){ const el=document.getElementById('errorMessage'); if(el){ el.textContent=m; el.style.display='block'; setTimeout(()=>el.style.display='none',5000);} }
        function mostrarExito(m){ const el=document.getElementById('successMessage'); if(el){ el.textContent=m; el.style.display='block'; setTimeout(()=>el.style.display='none',3000);} }

        // L√≥gica con datos por plataforma y recomendaciones
        let plataformaSeleccionada = 'uber';
        const plataformasData = {
            uber: {
                comision: 0.25,
                nombre: 'Uber',
                horariosPico: ['7-9', '12-14', '19-22'],
                consejos: [
                    'Trabaja en horarios pico para maximizar ganancias',
                    'Evita zonas con mucho tr√°fico en horas punta',
                    'Mant√©n el auto limpio para mejor rating'
                ]
            },
            didi: {
                comision: 0.20,
                nombre: 'DiDi',
                horariosPico: ['7-9', '12-14', '18-21'],
                consejos: [
                    'DiDi tiene menos comisi√≥n que Uber (20% vs 25%)',
                    'Acepta viajes largos, DiDi paga mejor distancia',
                    'Mant√©n 4.8+ de rating para recibir m√°s viajes',
                    'Los martes y mi√©rcoles suelen tener bonos extras'
                ]
            },
            rappi: {
                comision: 0.15,
                nombre: 'Rappi',
                horariosPico: ['12-15', '19-23'],
                consejos: [
                    'Acepta pedidos m√∫ltiples cuando sea posible',
                    'Posici√≥nate cerca de restaurantes populares',
                    'Los fines de semana son m√°s rentables'
                ]
            },
            pedidosya: {
                comision: 0.18,
                nombre: 'PedidosYa',
                horariosPico: ['12-14', '20-22'],
                consejos: [
                    'Mant√©n un buen puntaje para recibir m√°s pedidos',
                    'Conoce bien tu zona para ser m√°s r√°pido',
                    'Las lluvias aumentan la demanda'
                ]
            }
        };

        // Selecci√≥n de plataforma
        document.addEventListener('click', (e) => {
            const btn = e.target.closest('.platform-btn');
            if (!btn) return;
            document.querySelectorAll('.platform-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            plataformaSeleccionada = btn.getAttribute('data-platform');
            calcular();
        });

        function calcular() {
            const gananciaBruta = parseFloat(document.getElementById('ganancia-bruta').value) || 0;
            const horasDia = parseFloat(document.getElementById('horas-dia').value) || 1;
            const diasSemana = parseFloat(document.getElementById('dias-semana').value) || 1;
            const kmDia = parseFloat(document.getElementById('km-dia').value) || 0;
            const consumoAuto = parseFloat(document.getElementById('consumo-auto').value) || 1;
            const precioNafta = parseFloat(document.getElementById('precio-nafta').value) || 0;
            const gastosAdicionales = parseFloat(document.getElementById('gastos-adicionales').value) || 0;

            const plataforma = plataformasData[plataformaSeleccionada];
            const comisionPlataforma = gananciaBruta * plataforma.comision;
            const litrosConsumidos = kmDia / consumoAuto;
            const gastoNafta = litrosConsumidos * precioNafta;
            const gastosTotalesDia = gastoNafta + gastosAdicionales + comisionPlataforma;
            
            const gananciaNeta = gananciaBruta - gastosTotalesDia;
            const gananciaHora = gananciaNeta / horasDia;
            const gananciaSemana = gananciaNeta * diasSemana;
            const gananciaMes = gananciaSemana * 4.33;

            document.getElementById('ganancia-hora').textContent = `$${gananciaHora.toFixed(0)}`;
            document.getElementById('ganancia-dia').textContent = `$${gananciaNeta.toFixed(0)}`;
            document.getElementById('ganancia-semana').textContent = `$${gananciaSemana.toFixed(0)}`;
            document.getElementById('ganancia-mes').textContent = `$${gananciaMes.toFixed(0)}`;
            document.getElementById('gastos-totales').textContent = `$${gastosTotalesDia.toFixed(0)}`;

            generarRecomendaciones(gananciaHora, gananciaNeta, gastosTotalesDia, gananciaBruta);
        }

        function generarRecomendaciones(gananciaHora, gananciaNeta, gastos, gananciaBruta) {
            const plataforma = plataformasData[plataformaSeleccionada];
            let recomendaciones = `<h3>üìà An√°lisis para ${plataforma.nombre}</h3>`;
            if (gananciaHora > 1000) {
                recomendaciones += `<p>‚úÖ <strong>Excelente:</strong> Gan√°s $${gananciaHora.toFixed(0)} por hora. ¬°Manten√© este ritmo!</p>`;
            } else if (gananciaHora > 600) {
                recomendaciones += `<p>‚ö†Ô∏è <strong>Aceptable:</strong> Gan√°s $${gananciaHora.toFixed(0)} por hora. Pod√©s mejorar optimizando rutas.</p>`;
            } else {
                recomendaciones += `<p>üö® <strong>Mejorable:</strong> Gan√°s solo $${gananciaHora.toFixed(0)} por hora. Necesit√°s optimizar urgente.</p>`;
            }
            const porcentajeGastos = (gastos / gananciaBruta) * 100;
            recomendaciones += `<p><strong>Gastos:</strong> ${isFinite(porcentajeGastos) ? porcentajeGastos.toFixed(1) : 0}% de tu ganancia bruta.</p>`;
            if (porcentajeGastos > 60) recomendaciones += `<p>üö® Tus gastos son muy altos. Consider√° cambiar de auto o zona.</p>`;
            recomendaciones += `<h4>‚è∞ Horarios m√°s rentables:</h4><p>${plataforma.horariosPico.join(', ')}hs</p>`;
            recomendaciones += `<h4>üí° Consejos para ${plataforma.nombre}:</h4><ul>` + plataforma.consejos.map(c=>`<li>${c}</li>`).join('') + `</ul>`;
            const proyeccionAnual = gananciaNeta * 365;
            recomendaciones += `<h4>üéØ Proyecci√≥n anual: $${isFinite(proyeccionAnual)? proyeccionAnual.toLocaleString() : 0}</h4>`;
            document.getElementById('recomendaciones-content').innerHTML = recomendaciones;
            // Actualizar predictor IA en cada c√°lculo
            generarPrediccionesIA(gananciaHora, gananciaNeta, gastos, gananciaBruta, parseFloat(document.getElementById('horas-dia').value) || 1, parseFloat(document.getElementById('dias-semana').value) || 1);
        }

        // Motor de predicciones IA
        function generarPrediccionesIA(gananciaHora, gananciaNeta, gastos, gananciaBruta, horasDia, diasSemana) {
            const plataforma = plataformasData[plataformaSeleccionada];
            const optimizacion = analizarOptimizacion(gananciaHora, gananciaNeta, horasDia, diasSemana);
            document.getElementById('prediccion-optimizacion').innerHTML = optimizacion;
            const comparacion = compararPlataformas(gananciaBruta, gastos);
            document.getElementById('prediccion-comparacion').innerHTML = comparacion;
            const crecimiento = calcularCrecimiento(gananciaNeta, horasDia, diasSemana);
            document.getElementById('prediccion-crecimiento').innerHTML = crecimiento;
            const planAccion = generarPlanAccion(gananciaHora, plataforma.nombre, horasDia);
            document.getElementById('plan-accion').innerHTML = planAccion;
        }

        function analizarOptimizacion(gananciaHora, gananciaNeta, horasDia, diasSemana) {
            let optimizacion = '';
            if (gananciaHora < 800) {
                optimizacion += `üö® <span class="prediccion-highlight">Alerta:</span> Tu ganancia por hora est√° ${((800-gananciaHora)/800*100).toFixed(0)}% por debajo del promedio.<br><br>`;
                optimizacion += `üí° <strong>Recomendaci√≥n IA:</strong> Cambi√° tu horario al rango 18:30-22:30 para aumentar ganancias en <span class=\"prediccion-numero\">+$${(gananciaHora * 0.4).toFixed(0)}/hora</span>`;
            } else if (gananciaHora > 1200) {
                optimizacion += `‚úÖ <span class="prediccion-highlight">Excelente performance!</span><br><br>`;
                optimizacion += `üöÄ <strong>Oportunidad:</strong> Si manten√©s este ritmo y agreg√°s 1 d√≠a m√°s, ganar√≠as <span class=\"prediccion-numero\">+$${(gananciaNeta * 4.33).toFixed(0)}</span> extra al mes`;
            } else {
                optimizacion += `‚ö° <strong>Potencial detectado:</strong> Aumentando eficiencia en 15% ganar√≠as <span class=\"prediccion-numero\">+$${(gananciaHora * 0.15 * horasDia * diasSemana * 4.33).toFixed(0)}</span> mensual adicional<br><br>`;
                optimizacion += `üéØ Focaliz√° en: Horarios pico + Zonas premium + Rechazar viajes cortos`;
            }
            return optimizacion;
        }

        function compararPlataformas(gananciaBruta, gastos) {
            const plataformas = ['uber', 'didi', 'rappi', 'pedidosya'];
            let mejorOpcion = '';
            let maxGanancia = 0;
            let comparaciones = '<div style="margin-bottom: 15px;"><strong>Si trabajaras hoy en:</strong></div>';
            plataformas.forEach(plat => {
                const data = plataformasData[plat];
                const comision = gananciaBruta * data.comision;
                const gananciaReal = gananciaBruta - comision - gastos;
                comparaciones += `<div style="display:flex; justify-content:space-between; margin-bottom:8px;"><span>${data.nombre}:</span><span class=\"prediccion-numero\">$${gananciaReal.toFixed(0)}</span></div>`;
                if (gananciaReal > maxGanancia) { maxGanancia = gananciaReal; mejorOpcion = data.nombre; }
            });
            const actual = gananciaBruta - (gananciaBruta * plataformasData[plataformaSeleccionada].comision) - gastos;
            const diferencia = maxGanancia - actual;
            if (diferencia > 0) {
                comparaciones += `<br><div style="background: rgba(255,215,0,0.2); padding:10px; border-radius:5px; border-left:3px solid #ffd700;">üéØ <strong>Recomendaci√≥n:</strong> ${mejorOpcion} te conviene <span class=\"prediccion-numero\">$${diferencia.toFixed(0)} m√°s</span> por d√≠a</div>`;
            } else {
                comparaciones += `<br><div style="background: rgba(0,255,136,0.2); padding:10px; border-radius:5px;">‚úÖ Ya est√°s usando la plataforma m√°s rentable</div>`;
            }
            return comparaciones;
        }

        function calcularCrecimiento(gananciaNeta, horasDia, diasSemana) {
            const escenarios = [
                { titulo: "+2 horas diarias", calculo: (gananciaNeta / horasDia * 2 * diasSemana * 4.33).toFixed(0), descripcion: "Manteniendo mismo ritmo" },
                { titulo: "+1 d√≠a semanal", calculo: (gananciaNeta * 4.33).toFixed(0), descripcion: "Agregando fines de semana" },
                { titulo: "Optimizaci√≥n total", calculo: (gananciaNeta * 1.35 * diasSemana * 4.33).toFixed(0), descripcion: "Horarios + zonas premium" }
            ];
            return escenarios.map(e => `<div style=\"margin-bottom:12px; padding:10px; background: rgba(255,255,255,0.05); border-radius:5px;\"><div style=\"font-weight:bold;\">${e.titulo}</div><div style=\"color:#00ff88; font-size:1.1rem;\">+$${e.calculo} mensual</div><div style=\"font-size:.9rem; opacity:.8;\">${e.descripcion}</div></div>`).join('');
        }

        function generarPlanAccion(gananciaHora, plataforma, horasDia) {
            let plan = '<div style="text-align:left;">';
            plan += `<div style=\"margin-bottom:15px;\"><strong>üéØ Tu plan optimizado para ${plataforma}:</strong></div>`;
            if (gananciaHora < 800) {
                plan += `
        <div style=\"margin-bottom:10px;\">üìç <strong>1. Cambiar zonas:</strong> Movete a Palermo, Belgrano o Puerto Madero</div>
        <div style=\"margin-bottom:10px;\">‚è∞ <strong>2. Horarios premium:</strong> 7-9hs, 12-14hs, 18:30-22:30hs</div>
        <div style=\"margin-bottom:10px;\">üö´ <strong>3. Filtrar viajes:</strong> Rechazar distancias menores a 1.5km</div>
        <div style=\"margin-bottom:10px;\">üí∞ <strong>Resultado esperado:</strong> <span class=\"prediccion-numero\">+$400/hora</span></div>
        `;
            } else {
                plan += `
        <div style=\"margin-bottom:10px;\">‚úÖ <strong>1. Mantener rutina:</strong> Tu estrategia actual funciona</div>
        <div style=\"margin-bottom:10px;\">üìà <strong>2. Escalar:</strong> Agregar 1-2 horas en horarios pico</div>
        <div style=\"margin-bottom:10px;\">üéØ <strong>3. Optimizar:</strong> Usar m√∫ltiples apps simult√°neamente</div>
        <div style=\"margin-bottom:10px;\">üíé <strong>Potencial:</strong> <span class=\"prediccion-numero\">+$15,000/mes</span></div>
        `;
            }
            plan += '</div>'; return plan;
        }

        function exportarPDF() {
            const resultados = {
                plataforma: plataformasData[plataformaSeleccionada].nombre,
                gananciaHora: document.getElementById('ganancia-hora').textContent,
                gananciaDia: document.getElementById('ganancia-dia').textContent,
                gananciaSemana: document.getElementById('ganancia-semana').textContent,
                gananciaMes: document.getElementById('ganancia-mes').textContent
            };
            const contenido = `\nREPORTE DE GANANCIAS - ${resultados.plataforma}\n=====================================\n\nGanancia por hora: ${resultados.gananciaHora}\nGanancia diaria: ${resultados.gananciaDia}  \nGanancia semanal: ${resultados.gananciaSemana}\nGanancia mensual: ${resultados.gananciaMes}\n\nFecha: ${new Date().toLocaleDateString('es-AR')}\nCalculadora: drivemetrics.vercel.app\n`;
            const blob = new Blob([contenido], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a'); a.href = url; a.download = `reporte-ganancias-${plataformasData[plataformaSeleccionada].nombre.toLowerCase()}.txt`;
            document.body.appendChild(a); a.click(); document.body.removeChild(a); URL.revokeObjectURL(url);
            alert('üìÑ Reporte descargado!');
        }

        function compartir() {
            const resultados = `üöóüí∞ Mis ganancias reales en ${plataformasData[plataformaSeleccionada].nombre}:\n\nPor hora: ${document.getElementById('ganancia-hora').textContent}\nPor d√≠a: ${document.getElementById('ganancia-dia').textContent}\nPor mes: ${document.getElementById('ganancia-mes').textContent}\n\nCalcul√° las tuyas en: drivemetrics.vercel.app`;
            if (navigator.share) {
                navigator.share({ title: 'Calculadora de Ganancias DriveMetrics', text: resultados });
            } else {
                navigator.clipboard.writeText(resultados); alert('üì± Resultados copiados!');
            }
        }

        // C√°lculo autom√°tico
        document.addEventListener('input', (e)=>{
            if (e.target.matches('input')) { if (document.getElementById('ganancia-bruta').value) calcular(); }
        });
        window.addEventListener('load', ()=> setTimeout(calcular, 500));

        /* ==== Mapa de calor: datos y funciones ==== */
        const zonasArgentina = {
            'Buenos Aires': { premium: [
                { nombre: 'Puerto Madero', ganancia: 1400, multiplicador: 1.6 },
                { nombre: 'Palermo', ganancia: 1250, multiplicador: 1.4 },
                { nombre: 'Belgrano', ganancia: 1180, multiplicador: 1.35 },
                { nombre: 'Recoleta', ganancia: 1150, multiplicador: 1.3 },
                { nombre: 'Las Ca√±itas', ganancia: 1100, multiplicador: 1.25 },
                { nombre: 'Villa Crespo', ganancia: 950, multiplicador: 1.1 }
            ], horarios: {
                'Puerto Madero': ['7:00-9:30', '12:00-14:00', '18:30-22:00'],
                'Palermo': ['7:30-9:00', '12:30-15:00', '19:00-23:00'],
                'Belgrano': ['7:00-9:00', '12:00-14:30', '18:00-21:30']
            }, zonasBajas: ['La Boca', 'Barracas', 'Constituci√≥n'] },
            'C√≥rdoba': { premium: [
                { nombre: 'Nueva C√≥rdoba', ganancia: 950, multiplicador: 1.3 },
                { nombre: 'Centro', ganancia: 900, multiplicador: 1.2 },
                { nombre: 'Cerro de las Rosas', ganancia: 850, multiplicador: 1.15 },
                { nombre: 'Alto Palermo', ganancia: 800, multiplicador: 1.1 }
            ], horarios: {
                'Nueva C√≥rdoba': ['7:00-9:00', '12:00-14:00', '19:00-22:00'],
                'Centro': ['7:30-9:30', '12:30-14:30', '18:30-21:30']
            }, zonasBajas: ['San Vicente', 'Arguello'] },
            'Rosario': { premium: [
                { nombre: 'Centro', ganancia: 850, multiplicador: 1.25 },
                { nombre: 'Pichincha', ganancia: 800, multiplicador: 1.2 },
                { nombre: 'Fisherton', ganancia: 750, multiplicador: 1.15 },
                { nombre: 'Echesortu', ganancia: 700, multiplicador: 1.1 }
            ], horarios: {
                'Centro': ['7:00-9:00', '12:00-14:00', '18:30-21:30'],
                'Pichincha': ['7:30-9:30', '12:30-14:30', '19:00-22:00']
            }, zonasBajas: ['Empalme Graneros', 'La Tablada'] },
            'Mendoza': { premium: [
                { nombre: 'Ciudad Centro', ganancia: 800, multiplicador: 1.3 },
                { nombre: 'Las Heras', ganancia: 750, multiplicador: 1.2 },
                { nombre: 'Godoy Cruz', ganancia: 700, multiplicador: 1.15 },
                { nombre: 'Maip√∫', ganancia: 650, multiplicador: 1.1 }
            ], horarios: {
                'Ciudad Centro': ['7:00-9:00', '12:00-14:00', '19:00-21:30'],
                'Las Heras': ['7:30-9:30', '12:30-14:30', '18:30-21:00']
            }, zonasBajas: ['Luj√°n de Cuyo', 'Tupungato'] },
            'Salta': { premium: [
                { nombre: 'Centro Hist√≥rico', ganancia: 700, multiplicador: 1.25 },
                { nombre: 'Nueva Salta', ganancia: 650, multiplicador: 1.15 },
                { nombre: 'Tres Cerritos', ganancia: 600, multiplicador: 1.1 }
            ], horarios: { 'Centro Hist√≥rico': ['7:00-9:00', '12:00-14:00', '19:00-21:30'] },
              zonasBajas: ['Villa San Antonio', 'Cerrillos'] }
        };

        function detectarUbicacion(){
            const btn = document.getElementById('detectar-ubicacion'); if(!btn) return;
            btn.textContent='üìç Detectando...'; btn.disabled=true;
            if(navigator.geolocation){
                navigator.geolocation.getCurrentPosition(()=>{
                    const ciudades=Object.keys(zonasArgentina); const ciudad=ciudades[Math.floor(Math.random()*ciudades.length)];
                    mostrarAnalisisUbicacion(ciudad); btn.textContent='‚úÖ Ubicaci√≥n Detectada';
                },()=>{ mostrarSelectorCiudad(); btn.textContent='üìç Seleccionar Ciudad'; btn.disabled=false; });
            } else { mostrarSelectorCiudad(); btn.textContent='üìç Seleccionar Ciudad'; btn.disabled=false; }
        }
        function mostrarSelectorCiudad(){
            const container=document.querySelector('.ubicacion-detector'); if(!container) return;
            container.innerHTML=`<h3 style="color:white; margin-bottom:15px;">¬øEn qu√© ciudad trabaj√°s?</h3>
                <div style="display:grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap:10px;">
                    ${Object.keys(zonasArgentina).map(c=>`<button onclick=\"mostrarAnalisisUbicacion('${c}')\" class=\"ciudad-btn\">${c}</button>`).join('')}
                </div>`;
        }
        function mostrarAnalisisUbicacion(ciudad){
            const cd=document.getElementById('ciudad-detectada'); const ua=document.getElementById('ubicacion-actual');
            if(cd){ cd.textContent=ciudad; } if(ua){ ua.classList.remove('hidden'); }
            cargarZonasPremium(ciudad); analizarZonaActual(ciudad); mostrarComparacionZonas(ciudad); mostrarHorariosOptimos(ciudad);
        }
        function cargarZonasPremium(ciudad){
            const cont=document.getElementById('zonas-premium-list'); const data=zonasArgentina[ciudad]; if(!cont || !data){ if(cont) cont.innerHTML='<p>No hay datos disponibles</p>'; return; }
            let html=''; data.premium.forEach((z,i)=>{ html+=`<div class=\"zona-premium-item\" onclick=\"seleccionarZona('${ciudad}','${z.nombre}')\"><div><div class=\"zona-nombre-premium\">#${i+1} ${z.nombre}</div><div style=\"font-size:.8rem; color:#666;\">Multiplicador: ${z.multiplicador}x</div></div><div class=\"zona-ganancia\">$${z.ganancia}/hora</div></div>`; });
            html+='<div style="margin-top:15px; padding-top:15px; border-top:1px solid #eee;">'; html+='<h4 style="color:#ff4757; font-size:.9rem; margin-bottom:10px;">‚ö†Ô∏è Zonas de Bajo Rendimiento:</h4>';
            data.zonasBajas.forEach(z=>{ html+=`<div style=\"background:#ffebee; color:#c62828; padding:8px 12px; border-radius:5px; margin-bottom:5px; font-size:.9rem;\">${z} - Ganancia estimada: 40-60% menos</div>`; }); html+='</div>'; cont.innerHTML=html;
        }
        function analizarZonaActual(ciudad){
            const cont=document.getElementById('analisis-zona-actual'); const data=zonasArgentina[ciudad]; if(!cont || !data) return;
            const disponibles=[...data.premium, ...data.zonasBajas.map(z=>({nombre:z, ganancia:400, multiplicador:0.6}))];
            const zona=disponibles[Math.floor(Math.random()*disponibles.length)]; const mejor=data.premium[0];
            const diferencia=mejor.ganancia - (zona.ganancia||400); const porcentaje=Math.round((diferencia/(zona.ganancia||400))*100);
            let color='#00ff88', status='√ìptima', reco='¬°Est√°s en una zona excelente! Mantente aqu√≠ durante los horarios pico.';
            if(porcentaje>50){ color='#ff4757'; status='Baja rentabilidad'; reco=`Consider√° moverte a ${mejor.nombre} para ganar $${diferencia} m√°s por hora.`; }
            else if(porcentaje>20){ color='#ffa502'; status='Mejorable'; reco=`Podr√≠as ganar $${diferencia} m√°s por hora en ${mejor.nombre}.`; }
            cont.innerHTML=`<div style=\"display:grid; grid-template-columns:1fr 1fr; gap:15px; margin-bottom:15px;\"><div><strong>Zona Actual:</strong><br><span style=\"font-size:1.1rem;\">${zona.nombre}</span></div><div><strong>Estatus:</strong><br><span style=\"color:${color}; font-weight:bold;\">${status}</span></div></div><div style=\"background:#e3f2fd; padding:12px; border-radius:8px; border-left:4px solid #2196f3;\"><strong>üí° Recomendaci√≥n:</strong><br>${reco}</div><div style=\"margin-top:15px;\"><strong>Ganancia actual estimada:</strong> <span style=\"color:#667eea; font-weight:bold; font-size:1.1rem;\">$${zona.ganancia||400}/hora</span></div>`;
        }
        function mostrarComparacionZonas(ciudad){
            const cont=document.getElementById('comparacion-ganancias-zonas'); const data=zonasArgentina[ciudad]; if(!cont || !data) return; let html='';
            const top=data.premium[0].ganancia; data.premium.forEach((z,i)=>{ const diff=i===0?0:Math.round(((top - z.ganancia)/z.ganancia)*100); const clase= diff===0?'' : 'negativa'; const signo = diff===0? '' : '-'; html+=`<div class=\"zona-comparacion\" onclick=\"navegarAZona('${z.nombre}', ${z.ganancia})\"><div class=\"zona-nombre\">${z.nombre}</div><div class=\"zona-potencial\">$${z.ganancia}/hora</div><div class=\"zona-diferencia ${clase}\">${diff===0?'TOP':`${signo}${diff}%`}</div></div>`; }); cont.innerHTML=html;
        }
        function mostrarHorariosOptimos(ciudad){
            const cont=document.getElementById('horarios-optimizados'); const data=zonasArgentina[ciudad]; if(!cont || !data || !data.horarios){ cont.innerHTML='<p>No hay datos de horarios para esta ciudad</p>'; return; }
            let html=''; Object.entries(data.horarios).forEach(([zona, hs])=>{ html+=`<div class=\"horario-zona-item\"><div class=\"horario-zona-titulo\">üî• ${zona}</div><div class=\"horario-zona-detalle\"><strong>Horarios pico:</strong> ${hs.join(' ‚Ä¢ ')}</div><div style=\"margin-top:8px; font-size:.8rem; color:#666;\">üí∞ Ganancia m√°xima en estos horarios</div></div>`; });
            html+=`<div style=\"background: linear-gradient(45deg, #4CAF50, #45a049); color:white; padding:15px; border-radius:8px; margin-top:15px;\"><strong>üí° Consejos de horarios:</strong><br>‚Ä¢ Ma√±anas (7-9): Ejecutivos y oficinistas<br>‚Ä¢ Mediod√≠as (12-14): Almuerzos de negocios<br>‚Ä¢ Noches (19-22): Vida nocturna y cenas<br>‚Ä¢ Viernes/S√°bados: +25% de demanda promedio</div>`; cont.innerHTML=html;
        }
        function seleccionarZona(ciudad,nombre){ const z=zonasArgentina[ciudad].premium.find(x=>x.nombre===nombre); if(!z) return; mostrarModalZona(ciudad,z); }
        function mostrarModalZona(ciudad,zona){ const modal=document.createElement('div'); modal.style.cssText='position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.7);display:flex;justify-content:center;align-items:center;z-index:1000;'; modal.innerHTML=`<div style=\"background:white; border-radius:15px; padding:30px; max-width:500px; width:90%; max-height:80vh; overflow-y:auto;\"><div style=\"display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;\"><h2 style=\"color:#667eea; margin:0;\">üìç ${zona.nombre}</h2><button onclick=\"this.closest('div').parentNode.remove()\" style=\"background:#ff4757; color:white; border:none; border-radius:50%; width:30px; height:30px; cursor:pointer;\">√ó</button></div><div style=\"display:grid; grid-template-columns:1fr 1fr; gap:20px; margin-bottom:20px;\"><div style=\"text-align:center; padding:15px; background:#f8f9ff; border-radius:10px;\"><div style=\"font-size:2rem; color:#00ff88; font-weight:bold;\">$${zona.ganancia}</div><div style=\"color:#666;\">Ganancia/hora</div></div><div style=\"text-align:center; padding:15px; background:#f8f9ff; border-radius:10px;\"><div style=\"font-size:2rem; color:#667eea; font-weight:bold;\">${zona.multiplicador}x</div><div style=\"color:#666;\">Multiplicador</div></div></div><div style=\"background:#e8f5e8; padding:15px; border-radius:10px; margin-bottom:15px;\"><strong>üöÄ Proyecci√≥n diaria:</strong><br>‚Ä¢ 8 horas: $${zona.ganancia*8}<br>‚Ä¢ Con multiplicador: $${Math.round(zona.ganancia*8*zona.multiplicador)}<br>‚Ä¢ Ganancia extra: $${Math.round(zona.ganancia*8*(zona.multiplicador-1))}</div><div style=\"background:#fff3cd; padding:15px; border-radius:10px; margin-bottom:20px;\"><strong>‚è∞ Mejores horarios en ${zona.nombre}:</strong><br>${zonasArgentina[ciudad].horarios[zona.nombre]? zonasArgentina[ciudad].horarios[zona.nombre].join(' ‚Ä¢ ') : 'Consultar horarios locales'}</div><button onclick=\"navegarAZona('${zona.nombre}', ${zona.ganancia}); this.closest('div').parentNode.remove();\" style=\"width:100%; background: linear-gradient(45deg, #667eea, #764ba2); color:white; border:none; padding:15px; border-radius:25px; font-weight:bold; cursor:pointer; font-size:1.1rem;\">üß≠ Navegar a ${zona.nombre}</button></div>`; document.body.appendChild(modal); }
        function navegarAZona(nombre,gan){ if(confirm(`¬øQuieres navegar a ${nombre}? (Ganancia estimada: $${gan}/hora)`)){ alert(`üöÄ Iniciando navegaci√≥n a ${nombre}...`); guardarZonaSeleccionada(nombre,gan);} }
        function guardarZonaSeleccionada(zona,ganancia){ const hist=JSON.parse(localStorage.getItem('historialZonas')||'[]'); hist.push({zona,ganancia,fecha:new Date().toISOString(),timestamp:Date.now()}); if(hist.length>50){ hist.splice(0,hist.length-50);} localStorage.setItem('historialZonas', JSON.stringify(hist)); actualizarEstadisticasZonas(); }
        function actualizarEstadisticasZonas(){ const hist=JSON.parse(localStorage.getItem('historialZonas')||'[]'); if(hist.length===0) return; const frecu={}; let total=0; hist.forEach(r=>{ frecu[r.zona]=(frecu[r.zona]||0)+1; total+=r.ganancia; }); const fav=Object.entries(frecu).sort((a,b)=>b[1]-a[1])[0]; const prom=Math.round(total/hist.length); if(hist.length%10===0){ mostrarNotificacionEstadisticas(fav[0], prom, hist.length); } }
        function mostrarNotificacionEstadisticas(zonaFav, ganProm, total){ const n=document.createElement('div'); n.style.cssText='position:fixed; top:20px; right:20px; background:linear-gradient(45deg,#4CAF50,#45a049); color:white; padding:15px 20px; border-radius:10px; z-index:1001; box-shadow:0 4px 15px rgba(0,0,0,.3); max-width:300px;'; n.innerHTML=`<strong>üìä Estad√≠sticas Actualizadas</strong><br>üèÜ Zona favorita: ${zonaFav}<br>üí∞ Ganancia promedio: $${ganProm}/hora<br>üìç Zonas visitadas: ${total}`; document.body.appendChild(n); setTimeout(()=>n.remove(),5000); }
        function agregarEstilosCiudad(){ const style=document.createElement('style'); style.textContent=`.ciudad-btn{background:white;color:#667eea;border:2px solid transparent;padding:12px 20px;border-radius:25px;font-weight:600;cursor:pointer;transition:all .3s ease;font-size:.9rem}.ciudad-btn:hover{background:#667eea;color:white;transform:translateY(-2px);box-shadow:0 5px 15px rgba(102,126,234,.3)}.hidden{display:none!important}.zona-premium-item:hover{transform:translateX(5px); box-shadow:0 3px 10px rgba(0,0,0,.1)}.zona-comparacion:hover{background:#f0f8ff!important; cursor:pointer}`; document.head.appendChild(style);} 
        document.addEventListener('DOMContentLoaded', ()=>{ agregarEstilosCiudad(); const btn=document.getElementById('detectar-ubicacion'); if(btn) btn.addEventListener('click', detectarUbicacion); });

        window.iniciarGoogleAuth = iniciarGoogleAuth;
        window.cerrarSesion = cerrarSesion;
        window.getCurrentUser = () => currentUser;
        window.calcular = calcular;
        window.exportarPDF = exportarPDF;
        window.compartir = compartir;
    </script>
</body>
</html>


