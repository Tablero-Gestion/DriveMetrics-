<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>DriveMetrics - Alertas Premium</title>
  <style>
    body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:linear-gradient(135deg,#667eea,#764ba2);margin:0;padding:20px;color:#1f2a44}
    .wrap{max-width:1100px;margin:0 auto}
    .location-header{text-align:center;margin-bottom:30px}
    .detect-btn{background:white;color:#6366f1;padding:16px 32px;border:none;border-radius:50px;font-size:16px;font-weight:600;cursor:pointer;box-shadow:0 8px 25px rgba(0,0,0,0.15);transition:all 0.3s ease;display:inline-flex;align-items:center;gap:8px}
    .detect-btn:hover{transform:translateY(-2px);box-shadow:0 12px 35px rgba(0,0,0,0.2)}
    .detect-btn:disabled{opacity:0.6;cursor:not-allowed;transform:none}
    .location-info{background:rgba(255,255,255,0.1);padding:16px;border-radius:12px;margin-bottom:20px;border-left:4px solid #ffd700;display:none;color:#fff}
    .location-info.show{display:block}
    .location-info h4{color:#ffd700;margin-bottom:8px;font-size:16px}
    .location-info p{color:#fff;font-size:14px;margin:4px 0;opacity:0.9}
    .premium-alerts-section{background:#fff;padding:24px;border-radius:14px;box-shadow:0 10px 30px rgba(0,0,0,.08)}
    .muted{color:#6b7280;font-size:.95rem}
    .card{background:#f8f9ff;border:1px solid #eaeaea;border-radius:12px;padding:16px;margin-top:12px}
    .badge{padding:4px 8px;border-radius:8px;font-size:.8rem;font-weight:700}
    .badge-orange{background:#fff2e0;color:#b65a00}
    .badge-green{background:#e6f8ee;color:#16794d}
    .badge-red{background:#fee2e2;color:#dc2626}
    .badge-blue{background:#dbeafe;color:#1d4ed8}
    .spinner{display:inline-block;width:20px;height:20px;border:3px solid rgba(99,102,241,0.3);border-radius:50%;border-top-color:#6366f1;animation:spin 1s ease-in-out infinite}
    @keyframes spin{to{transform:rotate(360deg)}}
    .error-message{background:rgba(220,38,38,0.1);border:1px solid rgba(220,38,38,0.3);color:#fca5a5;padding:16px;border-radius:12px;margin-top:16px;display:none}
    .error-message.show{display:block}
    a.back{display:inline-block;margin-top:16px;background:#fff;color:#333;text-decoration:none;padding:10px 14px;border-radius:10px;font-weight:700}
  </style>
</head>
<body>
  <div class="wrap">
    <h1 style="color:#fff;margin:0 0 12px 0">üîî Alertas de Horarios Premium</h1>
    
    <div class="location-header">
      <button class="detect-btn" id="detectLocationBtn">üìç Detectar Mi Ubicaci√≥n</button>
    </div>
    
    <div class="location-info" id="locationInfo">
      <h4>üìç Ubicaci√≥n Detectada</h4>
      <div id="locationDetails"></div>
    </div>
    
    <div class="premium-alerts-section" id="alerts">
      <div class="card">
        <div class="muted">Estado actual</div>
        <div id="estado">Sin horarios premium activos</div>
      </div>
      <div class="card">
        <div class="muted">Pr√≥ximo horario premium</div>
        <div><strong id="proximo">Hoy 19:00 - 22:00</strong> <span class="badge badge-orange">+60% demanda</span></div>
      </div>
      <div class="card">
        <div class="muted">Recomendaci√≥n</div>
        <div>Concentrate en Palermo y Puerto Madero. Evit√° viajes < 1.5km.</div>
      </div>
    </div>
    
    <div class="error-message" id="errorMessage"></div>
    <a class="back" href="/">‚Üê Volver</a>
  </div>
  
  <script>
    let userLocation = null;
    let currentCity = null;
    
    // Datos de alertas por ciudad
    const cityAlerts = {
      'Buenos Aires': {
        estado: 'üü¢ Horarios premium activos en Palermo y Puerto Madero',
        proximo: 'Hoy 18:00 - 22:00',
        proximoBadge: '+75% demanda',
        proximoBadgeClass: 'badge-orange',
        recomendacion: 'Concentrate en Palermo, Puerto Madero y Recoleta. Evit√° viajes < 2km. Zona de mayor demanda: Palermo Soho.',
        alertas: [
          { tiempo: '06:00 - 09:00', zona: 'Microcentro', demanda: '+45%', tipo: 'badge-blue' },
          { tiempo: '12:00 - 14:00', zona: 'Puerto Madero', demanda: '+60%', tipo: 'badge-orange' },
          { tiempo: '18:00 - 22:00', zona: 'Palermo', demanda: '+75%', tipo: 'badge-orange' },
          { tiempo: '22:00 - 02:00', zona: 'Recoleta', demanda: '+55%', tipo: 'badge-green' }
        ]
      },
      'C√≥rdoba': {
        estado: 'üü° Horarios premium moderados en Nueva C√≥rdoba',
        proximo: 'Hoy 19:00 - 21:00',
        proximoBadge: '+50% demanda',
        proximoBadgeClass: 'badge-green',
        recomendacion: 'Concentrate en Nueva C√≥rdoba y G√ºemes. Evit√° viajes < 1.8km. Zona de mayor demanda: Nueva C√≥rdoba.',
        alertas: [
          { tiempo: '07:00 - 09:00', zona: 'Centro', demanda: '+35%', tipo: 'badge-blue' },
          { tiempo: '12:00 - 14:00', zona: 'Nueva C√≥rdoba', demanda: '+50%', tipo: 'badge-green' },
          { tiempo: '19:00 - 21:00', zona: 'G√ºemes', demanda: '+50%', tipo: 'badge-green' },
          { tiempo: '21:00 - 00:00', zona: 'Cerro de las Rosas', demanda: '+40%', tipo: 'badge-blue' }
        ]
      },
      'Rosario': {
        estado: 'üü¢ Horarios premium activos en Centro y Pichincha',
        proximo: 'Hoy 18:30 - 21:30',
        proximoBadge: '+65% demanda',
        proximoBadgeClass: 'badge-orange',
        recomendacion: 'Concentrate en Centro y Pichincha. Evit√° viajes < 1.6km. Zona de mayor demanda: Centro.',
        alertas: [
          { tiempo: '07:30 - 09:30', zona: 'Centro', demanda: '+40%', tipo: 'badge-blue' },
          { tiempo: '12:00 - 14:00', zona: 'Pichincha', demanda: '+55%', tipo: 'badge-green' },
          { tiempo: '18:30 - 21:30', zona: 'Centro', demanda: '+65%', tipo: 'badge-orange' },
          { tiempo: '21:30 - 00:30', zona: 'Pichincha', demanda: '+45%', tipo: 'badge-blue' }
        ]
      },
      'Mendoza': {
        estado: 'üü° Horarios premium moderados en Centro y Godoy Cruz',
        proximo: 'Hoy 19:00 - 22:00',
        proximoBadge: '+55% demanda',
        proximoBadgeClass: 'badge-green',
        recomendacion: 'Concentrate en Centro y Godoy Cruz. Evit√° viajes < 1.7km. Zona de mayor demanda: Centro.',
        alertas: [
          { tiempo: '08:00 - 10:00', zona: 'Centro', demanda: '+40%', tipo: 'badge-blue' },
          { tiempo: '12:00 - 14:00', zona: 'Godoy Cruz', demanda: '+45%', tipo: 'badge-blue' },
          { tiempo: '19:00 - 22:00', zona: 'Centro', demanda: '+55%', tipo: 'badge-green' },
          { tiempo: '22:00 - 01:00', zona: 'Godoy Cruz', demanda: '+35%', tipo: 'badge-blue' }
        ]
      },
      'default': {
        estado: 'Sin horarios premium activos',
        proximo: 'Hoy 19:00 - 22:00',
        proximoBadge: '+60% demanda',
        proximoBadgeClass: 'badge-orange',
        recomendacion: 'Concentrate en zonas c√©ntricas y comerciales. Evit√° viajes < 1.5km.',
        alertas: [
          { tiempo: '07:00 - 09:00', zona: 'Centro', demanda: '+40%', tipo: 'badge-blue' },
          { tiempo: '12:00 - 14:00', zona: 'Zona Comercial', demanda: '+50%', tipo: 'badge-green' },
          { tiempo: '19:00 - 22:00', zona: 'Centro', demanda: '+60%', tipo: 'badge-orange' },
          { tiempo: '22:00 - 01:00', zona: 'Zona Comercial', demanda: '+45%', tipo: 'badge-blue' }
        ]
      }
    };
    
    // Funci√≥n para obtener nombre de ciudad desde coordenadas
    async function getCityName(lat, lng) {
      try {
        const response = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}&addressdetails=1`);
        const data = await response.json();
        if (data && data.address) {
          return data.address.city || data.address.town || data.address.village || data.address.state || 'Ciudad no identificada';
        }
        return 'Ciudad no identificada';
      } catch {
        return 'Ciudad no identificada';
      }
    }
    
    // Funci√≥n para detectar ubicaci√≥n
    function detectLocation() {
      const btn = document.getElementById('detectLocationBtn');
      const errorMsg = document.getElementById('errorMessage');
      
      if (!navigator.geolocation) {
        showError('La geolocalizaci√≥n no es compatible con este navegador.');
        return;
      }
      
      btn.disabled = true;
      btn.innerHTML = '<div class="spinner"></div> Detectando...';
      errorMsg.classList.remove('show');
      
      navigator.geolocation.getCurrentPosition(
        async (position) => {
          userLocation = {
            lat: position.coords.latitude,
            lng: position.coords.longitude,
            accuracy: position.coords.accuracy
          };
          
          try {
            const cityName = await getCityName(userLocation.lat, userLocation.lng);
            currentCity = cityName;
            await updateAlerts(cityName);
            updateLocationInfo(cityName);
            btn.innerHTML = '‚úÖ Ubicaci√≥n Detectada';
          } catch (e) {
            showError('Error procesando la ubicaci√≥n: ' + e.message);
            btn.disabled = false;
            btn.innerHTML = 'üìç Detectar Mi Ubicaci√≥n';
          }
        },
        (error) => {
          const errorMap = {
            1: 'Permiso denegado. Por favor permite el acceso a tu ubicaci√≥n.',
            2: 'Informaci√≥n de ubicaci√≥n no disponible.',
            3: 'Tiempo de espera agotado al obtener ubicaci√≥n.'
          };
          showError(errorMap[error.code] || 'Error desconocido');
          btn.disabled = false;
          btn.innerHTML = 'üìç Detectar Mi Ubicaci√≥n';
        },
        {
          enableHighAccuracy: true,
          timeout: 10000,
          maximumAge: 60000
        }
      );
    }
    
    // Funci√≥n para actualizar alertas basadas en la ciudad
    async function updateAlerts(cityName) {
      const alerts = cityAlerts[cityName] || cityAlerts['default'];
      
      // Actualizar estado
      document.getElementById('estado').innerHTML = alerts.estado;
      
      // Actualizar pr√≥ximo horario
      const proximoElement = document.getElementById('proximo');
      proximoElement.innerHTML = alerts.proximo;
      
      // Actualizar badge del pr√≥ximo horario
      const proximoContainer = proximoElement.parentElement;
      proximoContainer.innerHTML = `
        <strong id="proximo">${alerts.proximo}</strong> 
        <span class="badge ${alerts.proximoBadgeClass}">${alerts.proximoBadge}</span>
      `;
      
      // Actualizar recomendaci√≥n
      const recomendacionCard = document.querySelector('.card:last-child');
      recomendacionCard.innerHTML = `
        <div class="muted">Recomendaci√≥n</div>
        <div>${alerts.recomendacion}</div>
      `;
      
      // Agregar alertas detalladas
      addDetailedAlerts(alerts.alertas);
    }
    
    // Funci√≥n para agregar alertas detalladas
    function addDetailedAlerts(alertas) {
      const alertsSection = document.getElementById('alerts');
      
      // Crear nueva card para alertas detalladas
      const detailedAlertsCard = document.createElement('div');
      detailedAlertsCard.className = 'card';
      detailedAlertsCard.innerHTML = `
        <div class="muted">üìä Alertas Detalladas por Zona</div>
        <div style="margin-top: 12px;">
          ${alertas.map(alerta => `
            <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px 0; border-bottom: 1px solid #eaeaea;">
              <div>
                <strong>${alerta.tiempo}</strong> - ${alerta.zona}
              </div>
              <span class="badge ${alerta.tipo}">${alerta.demanda}</span>
            </div>
          `).join('')}
        </div>
      `;
      
      // Agregar despu√©s de la √∫ltima card existente
      alertsSection.appendChild(detailedAlertsCard);
    }
    
    // Funci√≥n para actualizar informaci√≥n de ubicaci√≥n
    function updateLocationInfo(cityName) {
      const locationInfo = document.getElementById('locationInfo');
      const locationDetails = document.getElementById('locationDetails');
      const accuracy = userLocation ? Math.round(userLocation.accuracy) : 0;
      
      locationDetails.innerHTML = `
        <p><strong>Ciudad:</strong> ${cityName}</p>
        <p><strong>Coordenadas:</strong> ${userLocation.lat.toFixed(4)}, ${userLocation.lng.toFixed(4)}</p>
        <p><strong>Precisi√≥n:</strong> ¬±${accuracy} metros</p>
        <div style="background:rgba(255,215,0,0.1); padding:12px; border-radius:8px; margin-top:12px;">
          <p style="color:#ffd700; font-size:14px; margin:0;">‚úÖ Alertas personalizadas activadas para ${cityName}</p>
        </div>
      `;
      
      locationInfo.classList.add('show');
    }
    
    // Funci√≥n para mostrar errores
    function showError(message) {
      const errorMsg = document.getElementById('errorMessage');
      errorMsg.textContent = message;
      errorMsg.classList.add('show');
    }
    
    // Event listeners
    document.getElementById('detectLocationBtn').addEventListener('click', detectLocation);
    
    // Inicializaci√≥n
    window.addEventListener('load', () => {
      // Cargar alertas por defecto
      setTimeout(() => {
        updateAlerts('default');
      }, 800);
    });
  </script>
</body>
</html>



