<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>DriveMetrics - Predictor IA Premium</title>
  <style>
    body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:linear-gradient(135deg,#667eea,#764ba2);margin:0;padding:20px;color:#fff}
    .wrap{max-width:1100px;margin:0 auto}
    .location-header{text-align:center;margin-bottom:30px}
    .detect-btn{background:white;color:#6366f1;padding:16px 32px;border:none;border-radius:50px;font-size:16px;font-weight:600;cursor:pointer;box-shadow:0 8px 25px rgba(0,0,0,0.15);transition:all 0.3s ease;display:inline-flex;align-items:center;gap:8px}
    .detect-btn:hover{transform:translateY(-2px);box-shadow:0 12px 35px rgba(0,0,0,0.2)}
    .detect-btn:disabled{opacity:0.6;cursor:not-allowed;transform:none}
    .location-info{background:rgba(255,255,255,0.1);padding:16px;border-radius:12px;margin-bottom:20px;border-left:4px solid #ffd700;display:none}
    .location-info.show{display:block}
    .location-info h4{color:#ffd700;margin-bottom:8px;font-size:16px}
    .location-info p{color:#fff;font-size:14px;margin:4px 0;opacity:0.9}
    .predictor-ia-section{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);padding:40px 30px;border-radius:15px}
    .section-title{margin:0 0 10px 0}
    .predictor-container{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:18px;margin-top:18px}
    .prediccion-card{background:rgba(255,255,255,.1);padding:20px;border-radius:12px;border:1px solid rgba(255,255,255,.2)}
    .prediccion-card.full-width{grid-column:1 / -1}
    .ia-icon{text-align:center;font-size:2rem;margin-bottom:6px}
    .prediccion-content{background:rgba(255,255,255,.06);padding:12px;border-radius:8px;border-left:4px solid #ffd700}
    .prediccion-highlight{color:#ffd700;font-weight:700}
    .prediccion-numero{color:#00ff88;font-weight:700}
    .spinner{display:inline-block;width:20px;height:20px;border:3px solid rgba(255,255,255,0.3);border-radius:50%;border-top-color:#fff;animation:spin 1s ease-in-out infinite}
    @keyframes spin{to{transform:rotate(360deg)}}
    .error-message{background:rgba(220,38,38,0.1);border:1px solid rgba(220,38,38,0.3);color:#fca5a5;padding:16px;border-radius:12px;margin-top:16px;display:none}
    .error-message.show{display:block}
    a.back{display:inline-block;margin-top:16px;background:#fff;color:#333;text-decoration:none;padding:10px 14px;border-radius:10px;font-weight:700}
  </style>
</head>
<body>
  <div class="wrap">
    <h1 style="margin:0 0 12px 0">ü§ñ Predictor IA Premium</h1>
    
    <div class="location-header">
      <button class="detect-btn" id="detectLocationBtn">üìç Detectar Mi Ubicaci√≥n</button>
    </div>
    
    <div class="location-info" id="locationInfo">
      <h4>üìç Ubicaci√≥n Detectada</h4>
      <div id="locationDetails"></div>
    </div>
    
    <div class="predictor-ia-section">
      <div class="predictor-container">
        <div class="prediccion-card">
          <div class="ia-icon">üöÄ</div>
          <h3 style="text-align:center; margin:6px 0 10px 0">Optimizaci√≥n Autom√°tica</h3>
          <div id="prediccion-optimizacion" class="prediccion-content">Analizando tus datos...</div>
        </div>
        <div class="prediccion-card">
          <div class="ia-icon">üìä</div>
          <h3 style="text-align:center; margin:6px 0 10px 0">Comparaci√≥n Inteligente</h3>
          <div id="prediccion-comparacion" class="prediccion-content">Calculando mejores opciones...</div>
        </div>
        <div class="prediccion-card">
          <div class="ia-icon">üí∞</div>
          <h3 style="text-align:center; margin:6px 0 10px 0">Potencial de Crecimiento</h3>
          <div id="prediccion-crecimiento" class="prediccion-content">Evaluando oportunidades...</div>
        </div>
        <div class="prediccion-card full-width">
          <div class="ia-icon">üéØ</div>
          <h3 style="text-align:center; margin:6px 0 10px 0">Plan de Acci√≥n Personalizado</h3>
          <div id="plan-accion" class="prediccion-content">Generando estrategia √≥ptima...</div>
        </div>
      </div>
    </div>
    
    <div class="error-message" id="errorMessage"></div>
    <a class="back" href="/">‚Üê Volver</a>
  </div>
  
  <script>
    let userLocation = null;
    let currentCity = null;
    
    // Datos de predicciones por ciudad
    const cityPredictions = {
      'Buenos Aires': {
        optimizacion: 'üîé Ajustamos horarios y zonas para +35% de eficiencia en tu √°rea.',
        comparacion: 'üìà Hoy conviene Uber frente a DiDi (+$550/d√≠a en Palermo).',
        crecimiento: 'üöÄ Sumando 3 hs pico: +$28.000/mes aprox en Puerto Madero.',
        planAccion: '1) Trabaj√° 7-9 y 18-22 ‚Ä¢ 2) Zonas: Palermo/Puerto Madero ‚Ä¢ 3) Rechaz√° viajes < 2km'
      },
      'C√≥rdoba': {
        optimizacion: 'üîé Optimizamos rutas para +28% de eficiencia en Nueva C√≥rdoba.',
        comparacion: 'üìà Hoy conviene Rappi frente a Uber (+$400/d√≠a en Centro).',
        crecimiento: 'üöÄ Sumando 2 hs pico: +$18.000/mes aprox en G√ºemes.',
        planAccion: '1) Trabaj√° 8-10 y 19-21 ‚Ä¢ 2) Zonas: Nueva C√≥rdoba/G√ºemes ‚Ä¢ 3) Rechaz√° viajes < 1.8km'
      },
      'Rosario': {
        optimizacion: 'üîé Ajustamos zonas para +30% de eficiencia en tu ciudad.',
        comparacion: 'üìà Hoy conviene DiDi frente a Uber (+$380/d√≠a en Centro).',
        crecimiento: 'üöÄ Sumando 2.5 hs pico: +$20.000/mes aprox.',
        planAccion: '1) Trabaj√° 7-9 y 18-21 ‚Ä¢ 2) Zonas: Centro/Pichincha ‚Ä¢ 3) Rechaz√° viajes < 1.6km'
      },
      'Mendoza': {
        optimizacion: 'üîé Optimizamos horarios para +32% de eficiencia en tu √°rea.',
        comparacion: 'üìà Hoy conviene Uber frente a Rappi (+$420/d√≠a en Centro).',
        crecimiento: 'üöÄ Sumando 2 hs pico: +$19.000/mes aprox en Godoy Cruz.',
        planAccion: '1) Trabaj√° 8-10 y 19-22 ‚Ä¢ 2) Zonas: Centro/Godoy Cruz ‚Ä¢ 3) Rechaz√° viajes < 1.7km'
      },
      'default': {
        optimizacion: 'üîé Ajustamos horarios y zonas para +25% de eficiencia.',
        comparacion: 'üìà Hoy conviene PedidosYa frente a Uber (+$450/d√≠a).',
        crecimiento: 'üöÄ Sumando 2 hs pico: +$22.000/mes aprox.',
        planAccion: '1) Trabaj√° 7-9 y 19-22 ‚Ä¢ 2) Zonas: Centro/Comercial ‚Ä¢ 3) Rechaz√° viajes < 1.5km'
      }
    };
    
    // Funci√≥n para obtener nombre de ciudad desde coordenadas
    async function getCityName(lat, lng) {
      try {
        const response = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}&addressdetails=1`);
        const data = await response.json();
        if (data && data.address) {
          return data.address.city || data.address.town || data.address.village || data.address.state || 'Ciudad no identificada';
        }
        return 'Ciudad no identificada';
      } catch {
        return 'Ciudad no identificada';
      }
    }
    
    // Funci√≥n para detectar ubicaci√≥n
    function detectLocation() {
      const btn = document.getElementById('detectLocationBtn');
      const errorMsg = document.getElementById('errorMessage');
      
      if (!navigator.geolocation) {
        showError('La geolocalizaci√≥n no es compatible con este navegador.');
        return;
      }
      
      btn.disabled = true;
      btn.innerHTML = '<div class="spinner"></div> Detectando...';
      errorMsg.classList.remove('show');
      
      navigator.geolocation.getCurrentPosition(
        async (position) => {
          userLocation = {
            lat: position.coords.latitude,
            lng: position.coords.longitude,
            accuracy: position.coords.accuracy
          };
          
          try {
            const cityName = await getCityName(userLocation.lat, userLocation.lng);
            currentCity = cityName;
            await updatePredictions(cityName);
            updateLocationInfo(cityName);
            btn.innerHTML = '‚úÖ Ubicaci√≥n Detectada';
          } catch (e) {
            showError('Error procesando la ubicaci√≥n: ' + e.message);
            btn.disabled = false;
            btn.innerHTML = 'üìç Detectar Mi Ubicaci√≥n';
          }
        },
        (error) => {
          const errorMap = {
            1: 'Permiso denegado. Por favor permite el acceso a tu ubicaci√≥n.',
            2: 'Informaci√≥n de ubicaci√≥n no disponible.',
            3: 'Tiempo de espera agotado al obtener ubicaci√≥n.'
          };
          showError(errorMap[error.code] || 'Error desconocido');
          btn.disabled = false;
          btn.innerHTML = 'üìç Detectar Mi Ubicaci√≥n';
        },
        {
          enableHighAccuracy: true,
          timeout: 10000,
          maximumAge: 60000
        }
      );
    }
    
    // Funci√≥n para actualizar predicciones basadas en la ciudad
    async function updatePredictions(cityName) {
      const predictions = cityPredictions[cityName] || cityPredictions['default'];
      
      // Actualizar cada predicci√≥n
      set('prediccion-optimizacion', predictions.optimizacion);
      set('prediccion-comparacion', predictions.comparacion);
      set('prediccion-crecimiento', predictions.crecimiento);
      set('plan-accion', predictions.planAccion);
    }
    
    // Funci√≥n para actualizar informaci√≥n de ubicaci√≥n
    function updateLocationInfo(cityName) {
      const locationInfo = document.getElementById('locationInfo');
      const locationDetails = document.getElementById('locationDetails');
      const accuracy = userLocation ? Math.round(userLocation.accuracy) : 0;
      
      locationDetails.innerHTML = `
        <p><strong>Ciudad:</strong> ${cityName}</p>
        <p><strong>Coordenadas:</strong> ${userLocation.lat.toFixed(4)}, ${userLocation.lng.toFixed(4)}</p>
        <p><strong>Precisi√≥n:</strong> ¬±${accuracy} metros</p>
        <div style="background:rgba(255,215,0,0.1); padding:12px; border-radius:8px; margin-top:12px;">
          <p style="color:#ffd700; font-size:14px; margin:0;">‚úÖ Predicciones personalizadas activadas para ${cityName}</p>
        </div>
      `;
      
      locationInfo.classList.add('show');
    }
    
    // Funci√≥n para mostrar errores
    function showError(message) {
      const errorMsg = document.getElementById('errorMessage');
      errorMsg.textContent = message;
      errorMsg.classList.add('show');
    }
    
    // Funci√≥n helper para establecer contenido
    function set(id, html) {
      var el = document.getElementById(id);
      if (el) el.innerHTML = html;
    }
    
    // Event listeners
    document.getElementById('detectLocationBtn').addEventListener('click', detectLocation);
    
    // Inicializaci√≥n
    window.addEventListener('load', () => {
      // Cargar predicciones por defecto
      setTimeout(() => {
        updatePredictions('default');
      }, 800);
    });
  </script>
</body>
</html>



